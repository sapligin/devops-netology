# Домашнее задание к занятию "6.6. Troubleshooting"

## Задача 1

Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD операция в MongoDB и её нужно прервать.

Вы как инженер поддержки решили произвести данную операцию:

- напишите список операций, которые вы будете производить для остановки запроса пользователя
- предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB

## Решение:

В MongoDB Shell определяем операцию, которая продолжается больше 3 минут (180 секунд) командой:  
```
db.currentOp({"secs_running": {$gte: 180}})
```
Завершаем операцию по `opid` командой:
```
db.killOp()
```
Для решения проблемы с долгими запросами нужно убедиться, что используются индексы для работы с данными.  
Запросы, не использующие индексы увеличивают потребление I/O (чтений с диска будет больше), и CPU (если данные сжаты, так как для них требуется декомпрессия).  
Если индексы существуют, то возможно необходимо добавить дополнительные индексы для большей эффективности.

## Задача 2

Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причем отношение количества записанных key-value значений к количеству истёкших значений есть величина постоянная и увеличивается пропорционально количеству реплик сервиса.

При масштабировании сервиса до N реплик вы увидели, что:

- сначала рост отношения записанных значений к истекшим
- Redis блокирует операции записи

Как вы думаете, в чем может быть проблема?